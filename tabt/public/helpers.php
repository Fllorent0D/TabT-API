<?php/** \internal **************************************************************************** * TabT API *  A programming interface to access information managed *  by TabT, the table tennis information manager. * ----------------------------------------------------------------- * TabT helper functions * ----------------------------------------------------------------- * @version 0.8 * ----------------------------------------------------------------- * Copyright (C) 2007-2011 Gaëtan Frenoy (gaetan@frenoy.net) * ----------------------------------------------------------------- * This file is part of TabT API * * TabT API is free software: you can redistribute it and/or modify * it under the terms of the GNU Affero General Public License as * published by the Free Software Foundation, either version 3 of the * License, or (at your option) any later version. * * This program is distributed in the hope that it will be useful, * but WITHOUT ANY WARRANTY; without even the implied warranty of * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the * GNU Affero General Public License for more details. * * You should have received a copy of the GNU Affero General Public License * along with TabT API.  If not, see <http://www.gnu.org/licenses/>. **************************************************************************//** * Return all the relevant information concerning a given division * * @param[in] int   Season * @param[in] int   The division identifier * @param[in] bool  If set, display an error on screen (web interface only) * @return array information about the divison, false if an error occured */function get_division_info($season, $div_id, $show_error = true){  // Check input parameters  if (!isset($div_id) || $div_id == '')  {    return array();  }  $q = <<<EOQSELECT divisioninfo.div_id as 'div_id',       divisioninfo.serie as 'serie',       divisioncategories.name as 'category',       levelinfo.name as 'level',       levelinfo.id as 'level_id',       seasoninfo.name as 'season',       divisioninfo.calendar_id as 'calendar_id',       divisioncategories.id as 'category_id',       divisioninfo.extra_name as 'extra_name',       levelinfo.order as 'level_order'FROM divisioninfo,      levelinfo,     divisioncategories,     seasoninfoWHERE divisioninfo.id = {$div_id} and      divisioninfo.season = {$season} and      levelinfo.id = divisioninfo.level and      divisioninfo.category = divisioncategories.id and      seasoninfo.id = divisioninfo.season;EOQ;  $res = false;  $db = new DB_Session($q);  if ($db->next_record()) {    $res = $db->Record;  }  else if ($show_error) {    show_error("Unknow division");  }  $db->free();  return $res;} /** * Returns the human readable name of a divison * * @param[in] array information about the division (see get_division_info) * @param[in] bool  If set, season is hidden * @param[in] bool  the team to highlight * @param[in] bool  If set, short text (otherwise, long format) * @return array information about the divison, false if an error occured */function create_division_title_text($divinfo, $hide_season=false, $club_team='', $short_format = false) {  $res = '';  // Get translations  $levelname = $GLOBALS["str_{$divinfo['level']}"];  if ($levelname == '') $levelname = $divinfo['level'];  $catname = $GLOBALS["str_{$divinfo['category']}"];  if ($catname == '') $catname = $divinfo['category'];  if ($club_team!='') $res .= "{$club_team} - ";  if ($divinfo['div_id']>0) $res .= ($short_format?$GLOBALS['str_DivisionShort']:$GLOBALS['str_Division']) . ' ' . $divinfo['div_id'];  $res .= ($divinfo['div_id']>0||$divinfo['serie']==''?'':$GLOBALS['str_Serie'].' ') . $divinfo['serie'];  if (strlen($divinfo['extra_name']))  {    $res .= ($res==''?'':' ').$divinfo['extra_name'];  }  $res .= $res==''?'':' - ';  $res .= "{$levelname} - {$catname}";   if (!$hide_season)  {    $res .= "<br><span class=\"Interclubs_Title_2ndLine\">{$GLOBALS['str_Season']} {$divinfo['season']}</span>";  }  return $res;}  ?>